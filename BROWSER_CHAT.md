# Интеграция с ChatGPT через браузер

## Описание

В проекте реализована возможность обращения к ChatGPT через браузер вместо прямого API-вызова. Это позволяет:

1. Имитировать действия пользователя в браузере
2. Использовать полную функциональность ChatGPT, доступную через веб-интерфейс
3. Преобразовывать простые запросы пользователя в более сложные промпты для получения качественных ответов

## Архитектура

Интеграция с ChatGPT через браузер состоит из следующих компонентов:

1. **browser_chat.py** - модуль для взаимодействия с ChatGPT через браузер
   - Функция `send_query_to_chatgpt` - отправляет запрос в ChatGPT и получает ответ
   - Функция `create_chrome_driver` - создает и настраивает драйвер Chrome
   - Функция `wait_for_chatgpt_ready` - ожидает, пока ChatGPT будет готов к вводу запроса

2. **prompt_enhancer.py** - модуль для улучшения запросов пользователя
   - Функция `enhance_prompt` - преобразует простой запрос в более сложный промпт
   - Содержит шаблоны для различных типов запросов (общие, вопросы, инструкции, сравнения)

3. **orchestrator.py** - модуль для оркестрации взаимодействия с ChatGPT
   - Функция `orchestrate_browser_chat` - координирует процесс отправки запроса и получения ответа
   - Запускает TTS для озвучивания ответа

4. **gpt_service.py** - сервис для работы с GPT
   - Функция `handle_user_input` - определяет, нужно ли использовать браузерный чат или API
   - Функция `process_browser_chat` - обрабатывает запрос через браузерный чат

## Настройка

Настройки для браузерного чата находятся в файле `core/config.py`:

```python
# === Настройки для браузерного чата ===
USE_BROWSER_FOR_ALL_REQUESTS = os.getenv("USE_BROWSER_FOR_ALL_REQUESTS", "1").lower() in ("1", "true", "yes")
CHATGPT_URL = os.getenv("CHATGPT_URL", "https://chat.openai.com/")
HEADLESS_BROWSER = os.getenv("HEADLESS_BROWSER", "1").lower() in ("1", "true", "yes")
ENHANCE_PROMPTS = os.getenv("ENHANCE_PROMPTS", "1").lower() in ("1", "true", "yes")
```

Вы можете изменить эти настройки в файле `.env`:

```
USE_BROWSER_FOR_ALL_REQUESTS=1  # 1 - использовать браузер для всех запросов, 0 - только для запросов с триггером
CHATGPT_URL=https://chat.openai.com/  # URL для ChatGPT
HEADLESS_BROWSER=1  # 1 - запускать браузер в фоновом режиме, 0 - показывать браузер
ENHANCE_PROMPTS=1  # 1 - улучшать запросы, 0 - отправлять запросы как есть
```

## Процесс обработки запросов

1. Пользователь отправляет запрос через веб-интерфейс или голосом
2. Запрос обрабатывается в `gpt_service.py` функцией `handle_user_input`
3. Если настроено использование браузера для всех запросов (`USE_BROWSER_FOR_ALL_REQUESTS=1`), запрос направляется в функцию `process_browser_chat`
4. В `process_browser_chat` вызывается `orchestrate_browser_chat` из `orchestrator.py`
5. В `orchestrator.py` запрос передается в `browser_chat.py` функции `send_query_to_chatgpt`
6. Если включено улучшение промптов (`ENHANCE_PROMPTS=1`), запрос преобразуется с помощью `prompt_enhancer.py`
7. Браузер открывает ChatGPT, вводит запрос и получает ответ
8. Ответ возвращается пользователю и озвучивается с помощью TTS

## Примеры улучшения промптов

Модуль `prompt_enhancer.py` преобразует простые запросы пользователя в более сложные промпты для получения качественных ответов от ChatGPT.

### Примеры преобразования:

1. **Общий запрос**:
   - Исходный: "Расскажи о Казахстане"
   - Улучшенный: "Я хотел бы получить подробную информацию о следующем: Расскажи о Казахстане. Пожалуйста, предоставь исчерпывающий ответ с фактами и деталями."

2. **Вопрос**:
   - Исходный: "Что такое квантовая физика?"
   - Улучшенный: "У меня есть вопрос: Что такое квантовая физика?. Можешь дать мне исчерпывающий ответ с объяснением?"

3. **Инструкция**:
   - Исходный: "Как приготовить борщ?"
   - Улучшенный: "Я хотел бы узнать, как выполнить следующее: Как приготовить борщ?. Пожалуйста, предоставь пошаговую инструкцию."

4. **Сравнение**:
   - Исходный: "Сравни Python и JavaScript"
   - Улучшенный: "Я хотел бы сравнить: Сравни Python и JavaScript. Пожалуйста, предоставь детальное сравнение, включая сходства и различия."

## Требования

Для работы с браузерным чатом требуется:

1. Chrome/Chromium
2. ChromeDriver (устанавливается автоматически с selenium)
3. Selenium
4. Доступ к интернету

## Ограничения

1. Для работы с ChatGPT через браузер требуется аутентификация. Если вы не авторизованы в ChatGPT, вам нужно будет войти в систему вручную.
2. Если браузер запускается в фоновом режиме (`HEADLESS_BROWSER=1`), вы не сможете видеть процесс взаимодействия с ChatGPT.
3. Если у вас нет доступа к интернету, браузерный чат не будет работать.